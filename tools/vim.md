# vim

## 命令

命令        |说明
:-:         |:-
`.`         |重复上次的修改
`*`         |查找当前单词
`x`         |删除光标下的字符
`u`         |撤销上次修改
`dd`        |删除光标所在行 c
`s`         |删除字符并插入
`s`         |删除行并插入
`f{char}`   |查找当前行中下一处指定字符出现的位置并将光标跳转到指定字符
`;`         |重复上次 f/F/t/T
`,`         |回退上次 f/F/t/T

## 操作范围

Vim 操作范围 (Operating Range) 的表示方法为：`.` 表示当前行，`$` 表示结束，`%` 表示所有行，再加上 `+` 和 `-`，可灵活表示当前 Vim 打开文件的任意范围。

以删除命令 `:d` 为例，通过增加 Vim 文件范围，可修改删除命令的操作对象。

命令                |操作范围
:-                  |:-
`:d`                |当前行
`:.d`               |当前行
`:1d`               |第 5 行
`:$d`               |最后一行
`:%d`               |所有行
`:1,$d`             |所有行
`:.,5d`             |当前行至第 5 行
`:,5d`              |当前行至第 5 行
`:,+5d`             |当前行及向下 5 行
`:,-5d`             |当前行及向上 5 行
`:1,+5d`            |第一行至当前行及向下 5 行
`:3,'xdelete`       |第 3 行至标注为 x 的那一行
`:/^foo/,$delete`   |当前行以下，以字符 “foo” 开头的那一行至结尾
`:/^foo/+1,$delete` |当前行以下，以字符 “foo” 开头的那一行的下一行至结尾

除了 `,` 外，`;` 也可以分割行号用于表示 Vim 操作范围。区别在于，`a,b` 的 `b` 是以当前行作为参考，而 `a;b` 的 `b` 是以 `a` 行作为参考。
例如，假设当前光标所在为第 5 行，`:1,+1d` 命令会删除第 1 行至第 6 (5+1) 行，而 `:1;+1d` 命令则会删除第 1 行和第 2 (1+1) 行

如果想设置多个寻找条件，只需要在条件前再加上 `/`。
例如：`:/foo//bar//quux/d`，此命令首先在当前行之后寻找第一个包含 “foo” 字符的那一行，然后在找到的 这一行之后 寻找第一个包含 “bar” 字符的那一行，然后再在找到的这一行之后寻找第一个包含 “quux” 的那一行。

## 缩进

缩进 (Indent)

`>>` 缩进当前行

`<<` 反缩进当前行

使用 `v` 进入选择模式，然后使用 `>`，可多行缩进，反缩进同理。

`:1,10>` 缩进第 1 行到第 100 行，反缩进同理。

`:set tabstop=4` 设置tab宽度为 4 个字符

`:set shiftwidth=4` 设置自动缩进为 4 个字符

`:set expandtab` 设置用 space 代替 tab

`:set noexpandtab` 设置不用 space 代替 tab

`:%retab` 根据当前设置，重置文件中的 tab

在 Vim 里，使用 `set paste` 进入粘贴模式，会关闭自动缩进，使用 `set nopaste` 退出粘贴模式。

## 替换

替换 (Substitute)

语法：`[range]s[ubstitute]/{pattern}/{string}/[flags]`

操作范围：为了便于理解，可以将整个文件想象成一个二维平面，字符沿着 x 轴向右增加，而文本行则随着 y 轴向下增长。缺省情况下，substitute 命令仅仅作用于当前行，而且只会修改第一处匹配。

`[range]`: 查看操作范围小结。

`[flags]`：表示可选标志位，常用的包括 `g` 、`c`  、 `n` 、`e` 等。`g` 替换当前行所有; `c` 每次替换前询问; `n` 不执行替换操作，只统计和显示匹配个数; `e` 屏蔽错误提示。

例1：将当前行的第一个 aa 替换为 bb
答：`:s/aa/bb`

例2：将当前行的所有 aa 替换为 bb
答：`:s/aa/bb/g`

例3：将文档中所有 aa 替换为 bb
答：`:%s/aa/bb/g`

例4：将文档中所有 aa 替换为 bb，并替换每处时询问
答：`:%s/aa/bb/gc`，增加标志位 `c` 后，Vim 会在替换每处时询问 "Replace with bb(y/n/a/q/l)?"，`y` 确认一次修改，`n` 跳过一次修改，`a` (all)替换该处及该处后所有的匹配，`q` 退出此次替换过程，`l` (last)替换当前处匹配后直接退出替换过程。另外在替换过程中可以使用 `<Ctrl-e>` 和 `<Ctrl-y>` 向上向下滚动屏幕。

扩展：g 看似为全局 (global) 的含义，容易让人误以为 g 标志位是用于实现在整个文件范围内进行替换操作，但实际上，g 仅表示当前一整行范围。由于 vim 直接继承自 “行编辑器 ed”，对于行编辑器而言，全局的范围就是一行，这就是 g 标志位命令的由来。

## 折叠代码

命令|说明
:-:|:-
za|打开或关闭当前折叠
zc|折叠
zo|展开折叠
zM|折叠所有
zR|展开所有折叠

## 技巧

1. 在每行末尾添加一个分号

    ```vim
    a;<esc>j.j.
    ```

2. 在一行中的加号前后各加一个空格

    ```vim
    f+s<space>+<space><esc>;.;.
    ```
