<!--
 * @Author : Hu Jingbo
 * @Date   : 2021-07-31
-->

# 用户数据报协议(UDP)

UDP (User Datagram Protocol) 是一个不提供可靠性，无连接的面向数据包的传输层协议。

UDP 由于其特性，适用于无须应答、一次只传输较小数据的情况，如语音视频电话会议等 C/S 系统等

## UDP 首部

UDP 数据被封装在一个 IP 数据报中

```txt
+--------------------+--------+--------------+
|                    |   UDP  |          
|  IP Header (20 B)  | Header | UDP Data 
|                    |  (8 B) | 
+--------------------+--------+--------------+
```

UDP 首部格式 (UDP Header Format)

```txt
                  0      7 8     15 16    23 24    31
                 +--------+--------+--------+--------+
                 |     Source      |   Destination   |
                 |      Port       |      Port       |
                 +--------+--------+--------+--------+
                 |                 |                 |
                 |     Length      |    Checksum     |
                 +--------+--------+--------+--------+
                 |
                 |          data octets ...
                 +---------------- ...

                      User Datagram Header Format
```

* Source Prot：16 位源端口号

源端口号用于寻找发端的应用进程。

* Destiantion Port: 16 位目的端口号

目的端口用于寻找收端的应用进程。

* Length: 16 位长度字段

长度字段说明了 UDP 报文段的长度，该字段的最小值为 8 字节（发送一个长度为 0 的 UDP 数据报是可以的）。这个 UDP 长度是冗余的，IP 数据报长度指的是数据报的全长，因此 UDP 数据报的长度是全长减去 IP 首部的长度。

* Checksum：16 位检验和

UDP 检验和覆盖 UDP 首部和 UDP 数据，UDP 的检验和是可选的。

## UDP 检验和

UDP 检验和覆盖 UDP 首部和 UDP 数据，UDP 的检验和是可选的。UDP 检验和计算方法与 IP 首部检验和计算方法类似，但他们有不同之处。

首先，UDP 数据报的长度可以为奇数字节，但是检验和算法是把若干 16 位字相加。解决方法是必要时再最后增加填充字节 0，这是为了检验和的计算（也就是说，可以增加的填充字节不被传送）。

其次，UDP 数据报和 TCP 段都包含一个 12 字节长的伪首部，它是为了计算检验和而设置的。伪首部包含 IP 首部一些字段。其目的是让 UDP 两次检查数据是否已经正确到达目的地（例如，IP 没有接受地址不是本主机的数据报，以及 IP 没有把应传给另一高层的数据报传给 UDP）。UDP 数据报中的伪首部格式如下图所示。

```txt
                  0      7 8     15 16    23 24    31
                 +--------+--------+--------+--------+
                 |          source address           |
                 +--------+--------+--------+--------+
                 |        destination address        |
                 +--------+--------+--------+--------+
                 |  zero  |protocol|   UDP length    |
                 +--------+--------+--------+--------+
```

UDP 检验和是一个端到端的检验和。它由发送端计算，然后由接收端验证。其目的是为了发现 UDP 首部和数据在发送端到接收端之间发生的任何改动。
